#!/usr/bin/env ruby

require_relative '../lib/scout-gear'

$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))

dev_dir = nil
if _i = ARGV.index("--dev")
  dev_dir = ARGV[_i+1]
  ARGV.delete "--dev"
  ARGV.delete dev_dir
end

if dev_dir.nil? 
  _s = nil
  ARGV.each_with_index do |s,i|
    if s.match(/^--dev(?:=(.*))?/)
      dev_dir = $1
      _s = s
      next
    end
  end
  ARGV.delete _s if _s
end

if dev_dir
  Dir.glob(File.join(File.expand_path(dev_dir),'rbbt-*/lib')).each do |f|
    $LOAD_PATH.unshift f
  end
end

case
when File.exist?(file = File.join(__dir__, '../modules/rbbt-util/bin/rbbt'))
  $LOAD_PATH.unshift(lib_dir = File.join(file, '../..', 'lib'))
  require_relative File.join(lib_dir,'rbbt-util')
  Path.add_path(:rbbt, File.expand_path(File.join(File.dirname(lib_dir), "/{TOPLEVEL}/{SUBPATH}")))
  Path.default_pkgdir = Rbbt
  load file
when File.exist?(file = File.join(ENV["HOME"], 'git/scout-gear/modules/rbbt-util/bin/rbbt'))
  $LOAD_PATH.unshift(lib_dir = File.join(file, '../..', 'lib'))
  require_relative File.join(lib_dir,'rbbt-util')
  Path.add_path(:rbbt, File.expand_path(File.join(File.dirname(lib_dir), "/{TOPLEVEL}/{SUBPATH}")))
  Path.default_pkgdir = Rbbt
  load file
when File.exist?(file = File.join(ENV["HOME"], 'git/rbbt-util/bin/rbbt'))
  $LOAD_PATH.unshift(lib_dir = File.join(file, '../..', 'lib'))
  require_relative File.join(lib_dir,'rbbt-util')
  Path.add_path(:rbbt, File.expand_path(File.join(File.dirname(lib_dir), "/{TOPLEVEL}/{SUBPATH}")))
  Path.default_pkgdir = Rbbt
  load file
else
  raise "Cant find rbbt"
end
